/* css/guide-system.css - AI助手与页面引导样式整合 */

/* --- 动画定义 --- */
@keyframes shakeHorizontal {

	10%,
	90% {
		transform: translateX(-1px);
	}

	20%,
	80% {
		transform: translateX(2px);
	}

	30%,
	50%,
	70% {
		transform: translateX(-3px);
	}

	40%,
	60% {
		transform: translateX(3px);
	}
}

@keyframes fadeOutDown {
	from {
		opacity: 1;
		transform: translateY(0);
	}

	to {
		opacity: 0;
		transform: translateY(20px);
	}
}

@keyframes fadeInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}

	to {
		opacity: 1;
		transform: translateY(0);
	}
}

@keyframes fadeInDownSmall {
	from {
		opacity: 0;
		transform: translate(-50%, -10px);
	}

	to {
		opacity: 1;
		transform: translateX(-50%);
	}
}

/* --- 通用引导框 (提示框 & 聊天框基础) --- */
.guide-box {
	background-color: var(--background-white);
	color: var(--text-dark);
	font-size: 14px;
	border-radius: 12px;
	padding: 16px;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
	z-index: 9999;
	max-width: 320px;
	border: 1px solid var(--border-color);
}

html[data-theme='dark'] .guide-box {
	background-color: #2b2b2b;
	color: #e9ecef;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.4);
	border-color: #495057;
}

/* --- 页面引导步骤提示框 --- */
.guide-box.guide-step {
	position: absolute;
	animation: fadeInUp 0.3s ease-out;
}

.guide-box.guide-step button.dismiss-guide {
	margin-top: 12px;
	background: var(--button-bg);
	color: var(--button-text);
	border: none;
	padding: 6px 12px;
	border-radius: 8px;
	cursor: pointer;
	transition: background-color 0.2s ease;
}

.guide-box.guide-step button.dismiss-guide:hover {
	background: var(--button-hover-bg);
}

.guide-highlight {
	box-shadow: 0 0 0 2px var(--primary-blue, blue),
		0 0 8px 0px hsla(from var(--primary-blue, blue) h s l / 0.5);
	transition: box-shadow 0.2s ease;

}

.guide-floating-btn.guide-highlight {
	border-radius: 50% !important;
}

.hub-card.guide-highlight {
	border-radius: var(--card-border-radius, 12px) !important;
}

html[data-theme='dark'] .guide-highlight {
	box-shadow: 0 0 0 2px var(--primary-blue, blue),
		0 0 10px 1px hsla(from var(--primary-blue, blue) h s l / 0.7);
}

.guide-trigger-container {
	position: relative;
	text-align: center;
	margin-top: 20px;
	margin-bottom: 30px;
}

#show-guide-options-btn {
	padding: 8px 16px;
	font-size: 0.95em;
	border-radius: var(--border-radius, 6px);
	cursor: pointer;
	border: 1px solid var(--border-color, #ccc);
	background-color: var(--button-secondary-bg, var(--secondary-bg-color, #f0f0f0));
	color: var(--button-secondary-text, var(--text-color, #333));
	transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

#show-guide-options-btn:hover,
#show-guide-options-btn:focus-visible {
	background-color: var(--button-secondary-hover-bg, var(--hover-bg-color, #e0e0e0));
	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
	outline: 2px solid var(--accent-color, #007bff);
	outline-offset: 2px;
}

.guide-options-popup {
	position: absolute;
	top: calc(100% + 8px);
	left: 50%;
	transform: translateX(-50%);
	width: 280px;
	background-color: var(--card-bg, white);
	color: var(--text-color);
	border-radius: var(--border-radius, 6px);
	box-shadow: var(--box-shadow-md, 0 4px 12px rgba(0, 0, 0, 0.15));
	z-index: 10005;
	display: none;
	flex-direction: column;
	border: 1px solid var(--border-color, #ddd);
}

.guide-options-popup:not([hidden]) {
	display: flex;
	animation: fadeInDownSmall 0.2s ease-out forwards;
}

.guide-options-popup::before {
	content: '';
	position: absolute;
	bottom: 100%;
	left: 50%;
	transform: translateX(-50%);
	width: 0;
	height: 0;
	border-left: 8px solid transparent;
	border-right: 8px solid transparent;
	border-bottom: 8px solid var(--card-bg, white);
	filter: drop-shadow(0 -1px 0px var(--border-color, #ddd));
}

.guide-options-header {
	display: none;
}

.guide-options-body {
	padding: 15px;
	display: flex;
	flex-direction: column;
	gap: 10px;
}

.guide-options-body .button-primary {
	display: block;
	width: 100%;
	padding: 10px 15px;
	font-size: 0.95em;
	font-weight: 500;
	text-align: center;
	border-radius: var(--border-radius-sm, 4px);
	cursor: pointer;
	border: none;
	background-color: var(--primary-color, #007bff);
	color: white;
	transition: background-color 0.2s ease, transform 0.1s ease;
}

.guide-options-body .button-primary:hover {
	background-color: var(--primary-hover-color, #0056b3);
}

.guide-options-body .button-primary:active {
	transform: scale(0.98);
}


/* --- AI 助手悬浮按钮 --- */
.guide-floating-btn {
	position: fixed;
	bottom: 30px;
	left: 30px;
	width: 55px;
	height: 55px;
	background-color: var(--primary-blue);
	color: white;
	border-radius: 50%;
	border: none;
	box-sizing: border-box;
	/* 确保 box-sizing 正确 */
	font-size: 28px;
	cursor: pointer;
	z-index: 10000;
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
	display: flex;
	align-items: center;
	justify-content: center;
	transition: background-color 0.2s ease, transform 0.2s ease;
}

.guide-floating-btn:hover {
	background-color: var(--button-hover-bg);
	transform: scale(1.05);
}

html[data-theme='dark'] .guide-floating-btn {
	box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}

/* --- AI 助手聊天框 --- */
.guide-box.chat-box {
	position: fixed;
	bottom: 30px;
	left: 30px;
	max-width: 400px;
	z-index: 10001;
	cursor: default;
	animation: fadeInUp 0.3s ease-out;
	display: flex;
	flex-direction: column;
	max-height: 70vh;
	/* overflow: hidden; */
	/* 保持移除 */
}

.chat-box .topbar {
	display: flex;
	justify-content: space-between;
	align-items: center;
	font-size: 12px;
	background: var(--light-blue);
	color: var(--text-dark);
	border-radius: 8px 8px 0 0;
	padding: 6px 10px;
	margin: -16px -16px 10px -16px;
	cursor: grab;
	border-bottom: 1px solid var(--border-color);
	user-select: none;
	flex-shrink: 0;
	position: relative;
	z-index: 1;
}

.chat-box .topbar:active {
	cursor: grabbing;
}

html[data-theme='dark'] .chat-box .topbar {
	background: #3a3a3a;
	color: #ccc;
	border-bottom-color: #495057;
}

.chat-box .topbar span,
.chat-box .topbar button {
	cursor: pointer;
	background: none;
	border: none;
	color: inherit;
	padding: 2px 4px;
	border-radius: 4px;
	transition: background-color 0.2s ease;
}

.chat-box .topbar span:hover,
.chat-box .topbar button:hover {
	background-color: rgba(0, 0, 0, 0.1);
}

html[data-theme='dark'] .chat-box .topbar span:hover,
html[data-theme='dark'] .chat-box .topbar button:hover {
	background-color: rgba(255, 255, 255, 0.1);
}

#chat-wrapper {
	display: flex;
	flex-direction: column;
	gap: 8px;
	margin-bottom: 10px;
	padding-right: 5px;
	flex-grow: 1;
	flex-shrink: 1;
	min-height: 0;
	overflow-y: auto;
	scrollbar-width: thin;
	scrollbar-color: #aaa var(--background-white);
}

#chat-wrapper::-webkit-scrollbar {
	width: 6px;
}

#chat-wrapper::-webkit-scrollbar-thumb {
	background: #aaa;
	border-radius: 3px;
}

#chat-wrapper::-webkit-scrollbar-track {
	background: var(--background-white);
	border-radius: 3px;
}

html[data-theme='dark'] #chat-wrapper {
	scrollbar-color: #666 #2b2b2b;
}

html[data-theme='dark'] #chat-wrapper::-webkit-scrollbar-thumb {
	background: #666;
}

html[data-theme='dark'] #chat-wrapper::-webkit-scrollbar-track {
	background: #2b2b2b;
}

.chat-bubble {
	padding: 8px 14px;
	border-radius: 15px;
	max-width: 85%;
	word-wrap: break-word;
	line-height: 1.4;
	flex-shrink: 0;
}

.bubble-user {
	background: var(--primary-blue);
	color: var(--button-text);
	align-self: flex-end;
	margin-left: auto;
	border-bottom-right-radius: 5px;
}

.bubble-ai {
	background: var(--background-light);
	color: var(--text-dark);
	align-self: flex-start;
	margin-right: auto;
	border-bottom-left-radius: 5px;
	border: 1px solid var(--border-color);
}

html[data-theme='dark'] .bubble-user {
	background: var(--primary-blue);
	color: #111;
}

html[data-theme='dark'] .bubble-ai {
	background: #3a3a3a;
	color: var(--text-dark);
	border-color: #495057;
}

.chat-box #chat-input {
	width: 100%;
	padding: 8px 10px;
	border-radius: 8px;
	border: 1px solid var(--border-color);
	font-size: 14px;
	resize: none;
	background-color: var(--background-white);
	color: var(--text-dark);
	transition: border-color 0.2s ease;
	margin-bottom: 8px;
	flex-shrink: 0;
	font-family: inherit;
}

.chat-box #chat-input:focus {
	border-color: var(--primary-blue);
	outline: none;
	box-shadow: 0 0 0 2px hsla(from var(--primary-blue) h s l / 0.3);
}

html[data-theme='dark'] .chat-box #chat-input {
	background-color: #3a3a3a;
	color: var(--text-dark);
	border-color: #495057;
}

.chat-box div:has(> #chat-send) {
	flex-shrink: 0;
}

.chat-box #chat-send {
	padding: 8px 14px;
	border: none;
	border-radius: 8px;
	cursor: pointer;
	font-size: 14px;
	transition: background-color 0.2s ease, opacity 0.2s ease;
	flex-shrink: 0;
	background-color: var(--primary-blue);
	color: var(--button-text);
}

.chat-box #chat-send:hover {
	background-color: var(--button-hover-bg);
}

html[data-theme='dark'] .chat-box #chat-send {
	color: #111;
}

.chat-box #chat-send:disabled {
	background-color: var(--disabled-bg-color, #ccc);
	cursor: not-allowed;
	opacity: 0.7;
}

html[data-theme='dark'] .chat-box #chat-send:disabled {
	background-color: var(--dark-disabled-bg-color, #555);
	color: #999;
}

.chat-box.collapsed {
	max-height: none;
	height: auto;
	padding-bottom: 0;
}

.chat-box.collapsed .topbar {
	border-radius: 8px;
	margin-bottom: -16px;
}